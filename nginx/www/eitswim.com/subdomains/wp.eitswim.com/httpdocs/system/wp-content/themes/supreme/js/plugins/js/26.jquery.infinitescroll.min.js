/*!
   --------------------------------
   Infinite Scroll
   --------------------------------
   + https://github.com/paulirish/infinite-scroll
   + version 2.1.0
   + Copyright 2011/12 Paul Irish & Luke Shumard
   + Licensed under the MIT license

   + Documentation: http://infinite-scroll.com/
*/
(function(d,b,f){b.infinitescroll=function(h,g,e){this.element=b(e);if(!this._create(h,g)){this.failed=true}};b.infinitescroll.defaults={loading:{finished:f,finishedMsg:"<em>Congratulations, you've reached the end of the internet.44</em>",img:"",msg:null,msgText:"<em>Loading the next set of posts...</em>",selector:null,speed:"fast",start:f},state:{isDuringAjax:false,isInvalidPage:false,isDestroyed:false,isDone:false,isPaused:false,isBeyondMaxPage:false,currPage:1},debug:false,behavior:f,binder:b(d),nextSelector:"div.navigation a:first",navSelector:"div.navigation",contentSelector:null,extraScrollPx:150,itemSelector:"div.post",animate:false,pathParse:f,dataType:"html",appendCallback:true,bufferPx:40,errorCallback:function(){},infid:0,pixelsFromNavToBottom:f,path:f,prefill:false,maxPage:f};b.infinitescroll.prototype={_binding:function(g){var h=this,e=h.options;e.v="2.0b2.120520";if(!!e.behavior&&this["_binding_"+e.behavior]!==f){this["_binding_"+e.behavior].call(this);return}if(g!=="bind"&&g!=="unbind"){this._debug("Binding value  "+g+" not valid");return false}if(g==="unbind"){this.options.binder.unbind("smartscroll.infscr."+h.options.infid)}else{this.options.binder[g]("smartscroll.infscr."+h.options.infid,function(){h.scroll()})}this._debug("Binding",g)},_create:function(j,k){var n=b.extend(true,{},b.infinitescroll.defaults,j);this.options=n;var h=b(d);var g=this;if(!g._validate(j)){return false}var m=b(n.nextSelector).attr("href");if(!m){this._debug("Navigation selector not found");return false}n.path=n.path||this._determinepath(m);n.contentSelector=n.contentSelector||this.element;n.loading.selector=n.loading.selector||n.contentSelector;n.loading.msg=n.loading.msg||b('<div id="infscr-loading"><img alt="Loading..." src="'+n.loading.img+'" /><div>'+n.loading.msgText+"</div></div>");(new Image).src=n.loading.img;if(n.pixelsFromNavToBottom===f){n.pixelsFromNavToBottom=b(document).height()-b(n.navSelector).offset().top;this._debug("pixelsFromNavToBottom: "+n.pixelsFromNavToBottom)}var e=this;n.loading.start=n.loading.start||function(){b(n.navSelector).hide();n.loading.msg.appendTo(n.loading.selector).show(n.loading.speed,b.proxy(function(){this.beginAjax(n)},e))};n.loading.finished=n.loading.finished||function(){if(!n.state.isBeyondMaxPage){n.loading.msg.fadeOut(n.loading.speed)}};n.callback=function(p,o,l){if(!!n.behavior&&p["_callback_"+n.behavior]!==f){p["_callback_"+n.behavior].call(b(n.contentSelector)[0],o,l)}if(k){k.call(b(n.contentSelector)[0],o,n,l)}if(n.prefill){h.bind("resize.infinite-scroll",p._prefill)}};if(j.debug){if(Function.prototype.bind&&(typeof console==="object"||typeof console==="function")&&typeof console.log==="object"){["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(i){console[i]=this.call(console[i],console)},Function.prototype.bind)}}this._setup();if(n.prefill){this._prefill()}return true},_prefill:function(){function g(){return h.options.contentSelector.height()<=e.height()}var h=this;var e=b(d);this._prefill=function(){if(g()){h.scroll()}e.bind("resize.infinite-scroll",function(){if(g()){e.unbind("resize.infinite-scroll");h.scroll()}})};this._prefill()},_debug:function(){if(true!==this.options.debug){return}if(typeof console!=="undefined"&&typeof console.log==="function"){if(Array.prototype.slice.call(arguments).length===1&&typeof Array.prototype.slice.call(arguments)[0]==="string"){console.log(Array.prototype.slice.call(arguments).toString())}else{console.log(Array.prototype.slice.call(arguments))}}else{if(!Function.prototype.bind&&typeof console!=="undefined"&&typeof console.log==="object"){Function.prototype.call.call(console.log,console,Array.prototype.slice.call(arguments))}}},_determinepath:function(e){var g=this.options;if(!!g.behavior&&this["_determinepath_"+g.behavior]!==f){return this["_determinepath_"+g.behavior].call(this,e)}if(!!g.pathParse){this._debug("pathParse manual");return g.pathParse(e,this.options.state.currPage+1)}else{if(e.match(/^(.*?)\b2\b(.*?$)/)){e=e.match(/^(.*?)\b2\b(.*?$)/).slice(1)}else{if(e.match(/^(.*?)2(.*?$)/)){if(e.match(/^(.*?page=)2(\/.*|$)/)){e=e.match(/^(.*?page=)2(\/.*|$)/).slice(1);return e}e=e.match(/^(.*?)2(.*?$)/).slice(1)}else{if(e.match(/^(.*?page=)1(\/.*|$)/)){e=e.match(/^(.*?page=)1(\/.*|$)/).slice(1);return e}else{this._debug("Sorry, we couldn't parse your Next (Previous Posts) URL. Verify your the css selector points to the correct A tag. If you still get this error: yell, scream, and kindly ask for help at infinite-scroll.com.");g.state.isInvalidPage=true}}}}this._debug("determinePath",e);return e},_error:function(e){var g=this.options;if(!!g.behavior&&this["_error_"+g.behavior]!==f){this["_error_"+g.behavior].call(this,e);return}if(e!=="destroy"&&e!=="end"){e="unknown"}this._debug("Error",e);if(e==="end"||g.state.isBeyondMaxPage){this._showdonemsg()}g.state.isDone=true;g.state.currPage=1;g.state.isPaused=false;g.state.isBeyondMaxPage=false;this._binding("unbind")},_loadcallback:function(j,r,e){var q=this.options,p=this.options.callback,m=q.state.isDone?"done":!q.appendCallback?"no-append":"append",g;if(!!q.behavior&&this["_loadcallback_"+q.behavior]!==f){this["_loadcallback_"+q.behavior].call(this,j,r);return}switch(m){case"done":this._showdonemsg();return false;case"no-append":if(q.dataType==="html"){r="<div>"+r+"</div>";r=b(r).find(q.itemSelector)}break;case"append":var n=j.children();if(n.length===0){return this._error("end")}g=document.createDocumentFragment();while(j[0].firstChild){g.appendChild(j[0].firstChild)}this._debug("contentSelector",b(q.contentSelector)[0]);b(q.contentSelector)[0].appendChild(g);r=n.get();break}q.loading.finished.call(b(q.contentSelector)[0],q);if(q.animate){var k=b(d).scrollTop()+b(q.loading.msg).height()+q.extraScrollPx+"px";b("html,body").animate({scrollTop:k},800,function(){q.state.isDuringAjax=false})}if(!q.animate){q.state.isDuringAjax=false}p(this,r,e);if(q.prefill){this._prefill()}},_nearbottom:function(){var e=this.options,g=0+b(document).height()-e.binder.scrollTop()-b(d).height();if(!!e.behavior&&this["_nearbottom_"+e.behavior]!==f){return this["_nearbottom_"+e.behavior].call(this)}this._debug("math:",g,e.pixelsFromNavToBottom);return g-e.bufferPx<e.pixelsFromNavToBottom},_pausing:function(e){var g=this.options;if(!!g.behavior&&this["_pausing_"+g.behavior]!==f){this["_pausing_"+g.behavior].call(this,e);return}if(e!=="pause"&&e!=="resume"&&e!==null){this._debug("Invalid argument. Toggling pause value instead")}e=e&&(e==="pause"||e==="resume")?e:"toggle";switch(e){case"pause":g.state.isPaused=true;break;case"resume":g.state.isPaused=false;break;case"toggle":g.state.isPaused=!g.state.isPaused;break}this._debug("Paused",g.state.isPaused);return false},_setup:function(){var e=this.options;if(!!e.behavior&&this["_setup_"+e.behavior]!==f){this["_setup_"+e.behavior].call(this);return}this._binding("bind");return false},_showdonemsg:function(){var e=this.options;if(!!e.behavior&&this["_showdonemsg_"+e.behavior]!==f){this["_showdonemsg_"+e.behavior].call(this);return}e.loading.msg.find("img").hide().parent().find("div").html(e.loading.finishedMsg).animate({opacity:1},2000,function(){b(this).parent().fadeOut(e.loading.speed)});e.errorCallback.call(b(e.contentSelector)[0],"done")},_validate:function(g){for(var e in g){if(e.indexOf&&e.indexOf("Selector")>-1&&b(g[e]).length===0){this._debug("Your "+e+" found no elements.");return false}}return true},bind:function(){this._binding("bind")},destroy:function(){this.options.state.isDestroyed=true;this.options.loading.finished();return this._error("destroy")},pause:function(){this._pausing("pause")},resume:function(){this._pausing("resume")},beginAjax:function(k){var h=this,j=k.path,m,g,e,l;k.state.currPage++;if(k.maxPage!=f&&k.state.currPage>k.maxPage){k.state.isBeyondMaxPage=true;this.destroy();return}m=b(k.contentSelector).is("table, tbody")?b("<tbody/>"):b("<div/>");g=typeof j==="function"?j(k.state.currPage):j.join(k.state.currPage);h._debug("heading into ajax",g);e=k.dataType==="html"||k.dataType==="json"?k.dataType:"html+callback";if(k.appendCallback&&k.dataType==="html"){e+="+callback"}switch(e){case"html+callback":h._debug("Using HTML via .load() method");m.load(g+" "+k.itemSelector,f,function(i){h._loadcallback(m,i,g)});break;case"html":h._debug("Using "+e.toUpperCase()+" via $.ajax() method");b.ajax({url:g,dataType:k.dataType,complete:function(i,o){l=typeof i.isResolved!=="undefined"?i.isResolved():o==="success"||o==="notmodified";if(l){h._loadcallback(m,i.responseText,g)}else{h._error("end")}}});break;case"json":h._debug("Using "+e.toUpperCase()+" via $.ajax() method");b.ajax({dataType:"json",type:"GET",url:g,success:function(p,n,o){l=typeof o.isResolved!=="undefined"?o.isResolved():n==="success"||n==="notmodified";if(k.appendCallback){if(k.template!==f){var i=k.template(p);m.append(i);if(l){h._loadcallback(m,i)}else{h._error("end")}}else{h._debug("template must be defined.");h._error("end")}}else{if(l){h._loadcallback(m,p,g)}else{h._error("end")}}},error:function(){h._debug("JSON ajax request failed.");h._error("end")}});break}},retrieve:function(h){h=h||null;var e=this,g=e.options;if(!!g.behavior&&this["retrieve_"+g.behavior]!==f){this["retrieve_"+g.behavior].call(this,h);return}if(g.state.isDestroyed){this._debug("Instance is destroyed");return false}g.state.isDuringAjax=true;g.loading.start.call(b(g.contentSelector)[0],g)},scroll:function(){var e=this.options,g=e.state;if(!!e.behavior&&this["scroll_"+e.behavior]!==f){this["scroll_"+e.behavior].call(this);return}if(g.isDuringAjax||g.isInvalidPage||g.isDone||g.isDestroyed||g.isPaused){return}if(!this._nearbottom()){return}this.retrieve()},toggle:function(){this._pausing()},unbind:function(){this._binding("unbind")},update:function(e){if(b.isPlainObject(e)){this.options=b.extend(true,this.options,e)}}};b.fn.infinitescroll=function(j,h){var e=typeof j;switch(e){case"string":var g=Array.prototype.slice.call(arguments,1);this.each(function(){var i=b.data(this,"infinitescroll");if(!i){return false}if(!b.isFunction(i[j])||j.charAt(0)==="_"){return false}i[j].apply(i,g)});break;case"object":this.each(function(){var i=b.data(this,"infinitescroll");if(i){i.update(j)}else{i=new b.infinitescroll(j,h,this);if(!i.failed){b.data(this,"infinitescroll",i)}}});break}return this};var c=b.event,a;c.special.smartscroll={setup:function(){b(this).bind("scroll",c.special.smartscroll.handler)},teardown:function(){b(this).unbind("scroll",c.special.smartscroll.handler)},handler:function(i,j){var h=this,g=arguments;i.type="smartscroll";if(a){clearTimeout(a)}a=setTimeout(function(){b(h).trigger("smartscroll",g)},j==="execAsap"?0:100)}};b.fn.smartscroll=function(g){return g?this.bind("smartscroll",g):this.trigger("smartscroll",["execAsap"])}})(window,jQuery);