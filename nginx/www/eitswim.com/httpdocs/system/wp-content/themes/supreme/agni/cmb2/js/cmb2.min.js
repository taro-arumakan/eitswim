window.CMB2=window.CMB2||{};(function(g,h,f,c,a){var j=g.cmb2_l10;var e=g.setTimeout;var d;var i=function(k){return f(h.getElementById(k))};var b={idNumber:false,repeatEls:'input:not([type="button"],[id^=filelist]),select,textarea,.cmb2-media-status',noEmpty:'input:not([type="button"]):not([type="radio"]):not([type="checkbox"]),textarea',repeatUpdate:'input:not([type="button"]),select,textarea,label',styleBreakPoint:450,mediaHandlers:{},defaults:{time_picker:j.defaults.time_picker,date_picker:j.defaults.date_picker,color_picker:j.defaults.color_picker||{}},media:{frames:{}}};c.metabox=function(){if(c.$metabox){return c.$metabox}c.$metabox=f(".cmb2-wrap > .cmb2-metabox");return c.$metabox};c.init=function(){d=f(h);f.extend(c,b);c.trigger("cmb_pre_init");var k=c.metabox();var l=k.find(".cmb-repeatable-group");c.initPickers(k.find('input[type="text"].cmb2-timepicker'),k.find('input[type="text"].cmb2-datepicker'),k.find('input[type="text"].cmb2-colorpicker'));f('<p><span class="button cmb-multicheck-toggle">'+j.strings.check_toggle+"</span></p>").insertBefore(".cmb2-checkbox-list:not(.no-select-all)");c.makeListSortable();k.on("change",".cmb2_upload_file",function(){c.media.field=f(this).attr("id");i(c.media.field+"_id").val("")}).on("click",".cmb-multicheck-toggle",c.toggleCheckBoxes).on("click",".cmb2-upload-button",c.handleMedia).on("click",".cmb-attach-list li, .cmb2-media-status .img-status img, .cmb2-media-status .file-status > span",c.handleFileClick).on("click",".cmb2-remove-file-button",c.handleRemoveMedia).on("click",".cmb-add-group-row",c.addGroupRow).on("click",".cmb-add-row-button",c.addAjaxRow).on("click",".cmb-remove-group-row",c.removeGroupRow).on("click",".cmb-remove-row-button",c.removeAjaxRow).on("keyup paste focusout",".cmb2-oembed",c.maybeOembed).on("cmb2_remove_row",".cmb-repeatable-group",c.resetTitlesAndIterator).on("click",".cmbhandle, .cmbhandle + .cmbhandle-title",c.toggleHandle);if(l.length){l.filter(".sortable").each(function(){f(this).find(".button.cmb-remove-group-row").before('<a class="button cmb-shift-rows move-up alignleft" href="#"><span class="'+j.up_arrow_class+'"></span></a> <a class="button cmb-shift-rows move-down alignleft" href="#"><span class="'+j.down_arrow_class+'"></span></a>')}).on("click",".cmb-shift-rows",c.shiftRows).on("cmb2_add_row",c.emptyValue)}e(c.resizeoEmbeds,500);f(g).on("resize",c.resizeoEmbeds);c.trigger("cmb_init")};c.resetTitlesAndIterator=function(k){if(!k.group){return}f(".cmb-repeatable-group").each(function(){var l=f(this);l.find(".cmb-repeatable-grouping").each(function(n){var m=f(this);m.data("iterator",n);m.find(".cmb-group-title h4").text(l.find(".cmb-add-group-row").data("grouptitle").replace("{#}",(n+1)))})})};c.toggleHandle=function(k){k.preventDefault();c.trigger("postbox-toggled",f(this).parent(".postbox").toggleClass("closed"))};c.toggleCheckBoxes=function(k){k.preventDefault();var m=f(this);var l=m.closest(".cmb-td").find("input[type=checkbox]:not([disabled])");if(m.data("checked")){l.prop("checked",false);m.data("checked",false)}else{l.prop("checked",true);m.data("checked",true)}};c.handleMedia=function(k){k.preventDefault();var l=f(this);c.attach_id=!l.hasClass("cmb2-upload-list")?l.closest(".cmb-td").find(".cmb2-upload-file-id").val():false;c.attach_id="0"!==c.attach_id?c.attach_id:false;c._handleMedia(l.prev("input.cmb2-upload-file").attr("id"),l.hasClass("cmb2-upload-list"))};c.handleFileClick=function(k){k.preventDefault();var l=f(this);var n=l.closest(".cmb-td");var m=n.find(".cmb2-upload-button").hasClass("cmb2-upload-list");c.attach_id=m?l.find('input[type="hidden"]').data("id"):n.find(".cmb2-upload-file-id").val();if(c.attach_id){c._handleMedia(n.find("input.cmb2-upload-file").attr("id"),m,c.attach_id)}};c._handleMedia=function(k,n){if(!wp){return}var m=c.media;m.field=k;m.$field=i(m.field);m.fieldData=m.$field.data();m.previewSize=m.fieldData.previewsize;m.fieldName=m.$field.attr("name");m.isList=n;var l,o;if(m.field in m.frames){m.frames[m.field].open();return}m.frames[m.field]=wp.media({title:c.metabox().find('label[for="'+m.field+'"]').text(),library:m.fieldData.queryargs||{},button:{text:j.strings[n?"upload_files":"upload_file"]},multiple:n?"add":false});c.trigger("cmb_media_modal_init",m);c.mediaHandlers.list=function(r,p){o=r.toJSON();m.$field.val(o.url);i(m.field+"_id").val(o.id);var q=[];f(o).each(function(){if(this.type&&this.type==="image"){var t=m.previewSize[0]?m.previewSize[0]:50;var s=m.previewSize[1]?m.previewSize[1]:50;l='<li class="img-status"><img width="'+t+'" height="'+s+'" src="'+this.url+'" class="attachment-'+t+"px"+s+'px" alt="'+this.filename+'"><p><a href="#" class="cmb2-remove-file-button" rel="'+m.field+"["+this.id+']">'+j.strings.remove_image+'</a></p><input type="hidden" id="filelist-'+this.id+'" data-id="'+this.id+'" name="'+m.fieldName+"["+this.id+']" value="'+this.url+'"></li>'}else{l='<li class="file-status"><span>'+j.strings.file+" <strong>"+this.filename+'</strong></span>&nbsp;&nbsp; (<a href="'+this.url+'" target="_blank" rel="external">'+j.strings.download+'</a> / <a href="#" class="cmb2-remove-file-button" rel="'+m.field+"["+this.id+']">'+j.strings.remove_file+'</a>)<input type="hidden" id="filelist-'+this.id+'" data-id="'+this.id+'" name="'+m.fieldName+"["+this.id+']" value="'+this.url+'"></li>'}q.push(l)});if(!p){f(q).each(function(){m.$field.siblings(".cmb2-media-status").slideDown().append(this)})}else{return q}};c.mediaHandlers.single=function(q){o=q.first().toJSON();m.$field.val(o.url);i(m.field+"_id").val(o.id);if(o.type&&o.type==="image"){var p=m.previewSize[0]?m.previewSize[0]:350;l='<div class="img-status"><img width="'+p+'px" style="max-width: '+p+'px; width: 100%; height: auto;" src="'+o.url+'" alt="'+o.filename+'" title="'+o.filename+'" /><p><a href="#" class="cmb2-remove-file-button" rel="'+m.field+'">'+j.strings.remove_image+"</a></p></div>"}else{l='<div class="file-status"><span>'+j.strings.file+" <strong>"+o.filename+'</strong></span>&nbsp;&nbsp; (<a href="'+o.url+'" target="_blank" rel="external">'+j.strings.download+'</a> / <a href="#" class="cmb2-remove-file-button" rel="'+m.field+'">'+j.strings.remove_file+"</a>)</div>"}m.$field.siblings(".cmb2-media-status").slideDown().html(l)};c.mediaHandlers.selectFile=function(){var q=m.frames[m.field].state().get("selection");var p=n?"list":"single";if(c.attach_id&&n){f('[data-id="'+c.attach_id+'"]').parents("li").replaceWith(c.mediaHandlers.list(q,true))}else{c.mediaHandlers[p](q)}c.trigger("cmb_media_modal_select",q,m)};c.mediaHandlers.openModal=function(){var q=m.frames[m.field].state().get("selection");var p;if(!c.attach_id){q.reset()}else{p=wp.media.attachment(c.attach_id);p.fetch();q.set(p?[p]:[])}c.trigger("cmb_media_modal_open",q,m)};m.frames[m.field].on("select",c.mediaHandlers.selectFile).on("open",c.mediaHandlers.openModal);m.frames[m.field].open()};c.handleRemoveMedia=function(k){k.preventDefault();var l=f(this);if(l.is(".cmb-attach-list .cmb2-remove-file-button")){l.parents("li").remove();return false}c.media.field=l.attr("rel");c.metabox().find("input#"+c.media.field).val("");c.metabox().find("input#"+c.media.field+"_id").val("");l.parents(".cmb2-media-status").html("");return false};c.cleanRow=function(k,l,o){var m=k.find(c.repeatUpdate);if(o){var n=k.find("[id]").not(c.repeatUpdate);k.find(".cmb-repeat-table .cmb-repeat-row:not(:first-child)").remove();if(n.length){n.each(function(){var r=f(this);var s=r.attr("id");var p=s.replace("_"+l,"_"+c.idNumber);var q=k.find('[data-selector="'+s+'"]');r.attr("id",p);if(q.length){q.attr("data-selector",p).data("selector",p)}})}}m.filter(":checked").prop("checked",false);m.filter(":selected").prop("selected",false);if(k.find("h3.cmb-group-title").length){k.find("h3.cmb-group-title").text(k.data("title").replace("{#}",(c.idNumber+1)))}m.each(function(){c.elReplacements(f(this),l)});return c};c.elReplacements=function(s,o){var m=s.attr("for");var t=s.val();var r=s.prop("type");var l="radio"===r||"checkbox"===r?t:false;var u={};var p,n;if(m){u={"for":m.replace("_"+o,"_"+c.idNumber)}}else{var k=s.attr("name");var q=k?k.replace("["+o+"]","["+c.idNumber+"]"):"";n=s.attr("id");p=n?n.replace("_"+o,"_"+c.idNumber):"";u={id:p,name:q,"data-iterator":c.idNumber}}if(a!==typeof(t)&&t||l){u.value=l?l:""}if("TEXTAREA"===s.prop("tagName")){s.html("")}if(l){s.removeAttr("checked")}s.removeClass("hasDatepicker").attr(u).val(l?l:"");return s};c.newRowHousekeeping=function(k){var m=k.find(".wp-picker-container");var l=k.find(".cmb2-media-status");if(m.length){m.each(function(){var n=f(this).parent();n.html(n.find('input[type="text"].cmb2-colorpicker').attr("style",""))})}if(l.length){l.empty()}return c};c.afterRowInsert=function(k){c.initPickers(k.find('input[type="text"].cmb2-timepicker'),k.find('input[type="text"].cmb2-datepicker'),k.find('input[type="text"].cmb2-colorpicker'))};c.updateNameAttr=function(){var o=f(this);var l=o.attr("name");if(typeof l!=="undefined"){var m=parseInt(o.parents(".cmb-repeatable-grouping").data("iterator"),10);var n=m-1;var k=l.replace("["+m+"]","["+n+"]");o.attr("name",k)}};c.emptyValue=function(k,l){f(c.noEmpty,l).val("")};c.addGroupRow=function(l){l.preventDefault();var q=f(this);c.triggerElement(q,"cmb2_add_group_row_start",q);var m=i(q.data("selector"));var o=m.find(".cmb-repeatable-grouping").last();var n=parseInt(o.data("iterator"),10);c.idNumber=parseInt(n,10)+1;var k=o.clone();while(m.find('.cmb-repeatable-grouping[data-iterator="'+c.idNumber+'"]').length>0){c.idNumber++}c.newRowHousekeeping(k.data("title",q.data("grouptitle"))).cleanRow(k,n,true);k.find(".cmb-add-row-button").prop("disabled",false);var p=f('<div class="postbox cmb-row cmb-repeatable-grouping" data-iterator="'+c.idNumber+'">'+k.html()+"</div>");o.after(p);c.afterRowInsert(p);if(m.find(".cmb-repeatable-grouping").length<=1){m.find(".cmb-remove-group-row").prop("disabled",true)}else{m.find(".cmb-remove-group-row").prop("disabled",false)}c.triggerElement(m,{type:"cmb2_add_row",group:true},p)};c.addAjaxRow=function(l){l.preventDefault();var p=f(this);var m=i(p.data("selector"));var o=m.find(".empty-row");var n=parseInt(o.find("[data-iterator]").data("iterator"),10);c.idNumber=parseInt(n,10)+1;var k=o.clone();c.newRowHousekeeping(k).cleanRow(k,n);o.removeClass("empty-row hidden").addClass("cmb-repeat-row");o.after(k);c.afterRowInsert(k);c.triggerElement(m,{type:"cmb2_add_row",group:false},k);m.find(".cmb-remove-row-button").removeClass("button-disabled")};c.removeGroupRow=function(k){k.preventDefault();var o=f(this);var l=i(o.data("selector"));var n=o.parents(".cmb-repeatable-grouping");var m=l.find(".cmb-repeatable-grouping").length;if(m<2){return}c.triggerElement(l,"cmb2_remove_group_row_start",o);n.nextAll(".cmb-repeatable-grouping").find(c.repeatEls).each(c.updateNameAttr);n.remove();if(m<=2){l.find(".cmb-remove-group-row").prop("disabled",true)}else{l.find(".cmb-remove-group-row").prop("disabled",false)}c.triggerElement(l,{type:"cmb2_remove_row",group:true})};c.removeAjaxRow=function(k){k.preventDefault();var o=f(this);if(o.hasClass("button-disabled")){return}var n=o.parents(".cmb-row");var l=o.parents(".cmb-repeat-table");var m=l.find(".cmb-row").length;if(m>2){if(n.hasClass("empty-row")){n.prev().addClass("empty-row").removeClass("cmb-repeat-row")}o.parents(".cmb-repeat-table .cmb-row").remove();if(m===3){l.find(".cmb-remove-row-button").addClass("button-disabled")}c.triggerElement(l,{type:"cmb2_remove_row",group:false})}else{o.addClass("button-disabled")}};c.shiftRows=function(l){l.preventDefault();var o=f(this);var m=o.parents(".cmb-repeatable-grouping");var k=o.hasClass("move-up")?m.prev(".cmb-repeatable-grouping"):m.next(".cmb-repeatable-grouping");c.triggerElement(o,"cmb2_shift_rows_enter",o,m,k);if(!k.length){return}c.triggerElement(o,"cmb2_shift_rows_start",o,m,k);var n=[];m.find(c.repeatEls).each(function(){var q=f(this);var p=q.attr("type");var r;if(q.hasClass("cmb2-media-status")){r=q.html()}else{if("checkbox"===p||"radio"===p){r=q.is(":checked")}else{if("select"===q.prop("tagName")){r=q.is(":selected")}else{r=q.val()}}}n.push({val:r,$:q})});k.find(c.repeatEls).each(function(s){var q=f(this);var p=q.attr("type");var t;if(q.hasClass("cmb2-media-status")){var r=q.closest(".cmb-repeatable-grouping").attr("data-iterator");var u=n[s].$.closest(".cmb-repeatable-grouping").attr("data-iterator");t=q.html();q.html(n[s].val);n[s].$.html(t);n[s].$.find("input").each(function(){var v=f(this).attr("name");v=v.replace("["+r+"]","["+u+"]");f(this).attr("name",v)});q.find("input").each(function(){var v=f(this).attr("name");v=v.replace("["+u+"]","["+r+"]");f(this).attr("name",v)})}else{if("checkbox"===p){n[s].$.prop("checked",q.is(":checked"));q.prop("checked",n[s].val)}else{if("radio"===p){if(q.is(":checked")){n[s].$.attr("data-checked","true")}if(n[s].$.is(":checked")){q.attr("data-checked","true")}}else{if("select"===q.prop("tagName")){n[s].$.prop("selected",q.is(":selected"));q.prop("selected",n[s].val)}else{n[s].$.val(q.val());q.val(n[s].val)}}}}});m.find("input[data-checked=true]").prop("checked",true).removeAttr("data-checked");k.find("input[data-checked=true]").prop("checked",true).removeAttr("data-checked");m.find('input[type="text"].cmb2-colorpicker').trigger("change");k.find('input[type="text"].cmb2-colorpicker').trigger("change");c.triggerElement(o,"cmb2_shift_rows_complete",o,m,k)};c.initPickers=function(l,m,k){c.initDateTimePickers(l,"timepicker","time_picker");c.initDateTimePickers(m,"datepicker","date_picker");c.initColorPickers(k)};c.initDateTimePickers=function(l,m,k){if(l.length){l[m]("destroy").each(function(){var p=f(this);var n=p.data(m)||{};var o=f.extend({},c.defaults[k],n);p[m](c.datePickerSetupOpts(n,o,m))})}};c.datePickerSetupOpts=function(k,l,n){var m=f.extend({},l);l.beforeShow=function(o,p){if("timepicker"===n){c.addTimePickerClasses(p.dpDiv)}i("ui-datepicker-div").addClass("cmb2-element");if("function"===typeof m.beforeShow){m.beforeShow(o,p)}};if("timepicker"===n){l.onChangeMonthYear=function(p,r,q,o){c.addTimePickerClasses(q.dpDiv);if("function"===typeof m.onChangeMonthYear){m.onChangeMonthYear(p,r,q,o)}}}l.onClose=function(p,o){i("ui-datepicker-div").removeClass("cmb2-element").hide();if("function"===typeof m.onClose){m.onClose(p,o)}};return l};c.addTimePickerClasses=function(l){var k=c.addTimePickerClasses;k.count=k.count||0;e(function(){if(l.find(".ui-priority-secondary").length){l.find(".ui-priority-secondary").addClass("button-secondary");l.find(".ui-priority-primary").addClass("button-primary");k.count=0}else{if(k.count<5){k.count++;k(l)}}},10)};c.initColorPickers=function(k){if(!k.length){return}if(typeof jQuery.wp==="object"&&typeof jQuery.wp.wpColorPicker==="function"){k.each(function(){var m=f(this);var l=m.data("colorpicker")||{};m.wpColorPicker(f.extend({},c.defaults.color_picker,l))})}else{k.each(function(l){f(this).after('<div id="picker-'+l+'" style="z-index: 1000; background: #EEE; border: 1px solid #CCC; position: absolute; display: block;"></div>');i("picker-"+l).hide().farbtastic(f(this))}).focus(function(){f(this).next().show()}).blur(function(){f(this).next().hide()})}};c.makeListSortable=function(){var k=c.metabox().find(".cmb2-media-status.cmb-attach-list");if(k.length){k.sortable({cursor:"move"}).disableSelection()}};c.maybeOembed=function(l){var n=f(this);var k={focusout:function(){e(function(){c.spinner(".postbox .cmb2-metabox",true)},2000)},keyup:function(){var m=function(p,o){return(l.which<=o&&l.which>=p)};if(m(48,90)||m(96,111)||m(8,9)||l.which===187||l.which===190){c.doAjax(n,l)}},paste:function(){e(function(){c.doAjax(n)},100)}};k[l.type]()};c.resizeoEmbeds=function(){c.metabox().each(function(){var r=f(this);var p=r.parents(".inside");var l=r.parents(".inner-sidebar").length||r.parents("#side-sortables").length;var n=l;var m=false;if(!p.length){return true}var k=p.width();if(c.styleBreakPoint>k){n=true;m=(c.styleBreakPoint-62)>k}k=n?k:Math.round((p.width()*0.82)*0.97);var o=k-30;if(n&&!l&&!m){o=o-75}if(o>639){return true}var q=r.find(".cmb-type-oembed .embed-status");var s=q.children().not(".cmb2-remove-wrapper");if(!s.length){return true}s.each(function(){var w=f(this);var u=w.width();var x=w.height();var v=o;if(w.parents(".cmb-repeat-row").length&&!n){v=o-91;v=785>k?v-15:v}var t=Math.round((v*x)/u);w.width(v).height(t)})})};c.log=function(){if(j.script_debug&&console&&typeof console.log==="function"){console.log.apply(console,arguments)}};c.spinner=function(k,l){if(l){f(".cmb-spinner",k).hide()}else{f(".cmb-spinner",k).show()}};c.doAjax=function(r){var n=r.val();if(n.length<6){return}var o=r.attr("id");var k=r.closest(".cmb-td");var q=k.find(".embed-status");var p=k.find(".embed_wrap");var l=q.find(":first-child");var m=q.length&&l.length?l.width():r.width();c.log("oembed_url",n,o);c.spinner(k);p.html("");e(function(){if(f(".cmb2-oembed:focus").val()!==n){return}f.ajax({type:"post",dataType:"json",url:j.ajaxurl,data:{action:"cmb2_oembed_handler",oembed_url:n,oembed_width:m>300?m:300,field_id:o,object_id:r.data("objectid"),object_type:r.data("objecttype"),cmb2_ajax_nonce:j.ajax_nonce},success:function(s){c.log(s);c.spinner(k,true);p.html(s.data)}})},500)};c.trigger=function(l){var k=Array.prototype.slice.call(arguments,1);k.push(c);d.trigger(l,k)};c.triggerElement=function(l,m){var k=Array.prototype.slice.call(arguments,2);k.push(c);l.trigger(m,k)};f(c.init)})(window,document,jQuery,window.CMB2);